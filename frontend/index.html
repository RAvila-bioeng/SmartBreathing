<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SmartBreathing - Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    * {margin:0; padding:0; box-sizing:border-box;}
    body {font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height:100vh; padding:20px;}
    .container {max-width:1200px; margin:0 auto;}
    .header {text-align:center; color:white; margin-bottom:30px;}
    .header h1 {font-size:2.5rem; margin-bottom:10px;}
    .header p {font-size:1.2rem; opacity:0.9;}
    .metrics-grid {display:grid; grid-template-columns:repeat(auto-fit, minmax(300px,1fr)); gap:20px; margin-bottom:30px;}
    .metric-card {background:white; border-radius:15px; padding:25px; box-shadow:0 10px 30px rgba(0,0,0,0.1); transition:transform 0.3s ease;}
    .metric-card:hover {transform:translateY(-5px);}
    .metric-title {font-size:1.1rem; color:#333; margin-bottom:15px; font-weight:600;}
    .metric-value {font-size:2.5rem; font-weight:bold; color:#667eea; margin-bottom:10px;}
    .metric-unit {font-size:0.9rem; color:#666;}
    .chart-container {background:white; border-radius:15px; padding:25px; box-shadow:0 10px 30px rgba(0,0,0,0.1); margin-bottom:20px;}
    .chart-title {font-size:1.3rem; color:#333; margin-bottom:20px; font-weight:600;}
    .status-indicator {display:inline-block; width:12px; height:12px; border-radius:50%; margin-right:8px;}
    .status-good { background-color: #4CAF50; }
    .status-warning { background-color: #FF9800; }
    .status-danger { background-color: #F44336; }
    .loading { text-align:center; color:#666; font-style:italic; }
    .button-next {background:linear-gradient(135deg, #667eea 0%, #764ba2 100%); color:white; border:none; padding:15px 30px; font-size:1.1rem; border-radius:25px; cursor:pointer; transition:all 0.3s ease; font-weight:600; margin-top:15px; display:block; margin-left:auto; margin-right:auto;}
    .button-next:hover {box-shadow:0 5px 15px rgba(102,126,234,0.4);}
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üßò‚Äç‚ôÇÔ∏è SmartBreathing</h1>
      <p>Dashboard de Monitoreo Fisiol√≥gico</p>
    </div>

    <div class="metrics-grid">
      <div class="metric-card">
        <div class="metric-title">Saturaci√≥n de Ox√≠geno (SpO‚ÇÇ)</div>
        <div class="metric-value" id="spo2-value">--</div>
        <div class="metric-unit">%</div>
        <div class="status-indicator status-good" id="spo2-status"></div>
        <span id="spo2-text">Normal</span>
      </div>
      <div class="metric-card">
        <div class="metric-title">Nivel de CO‚ÇÇ</div>
        <div class="metric-value" id="co2-value">--</div>
        <div class="metric-unit">ppm</div>
        <div class="status-indicator status-good" id="co2-status"></div>
        <span id="co2-text">Normal</span>
      </div>
      <div class="metric-card">
        <div class="metric-title">Frecuencia Card√≠aca</div>
        <div class="metric-value" id="hr-value">--</div>
        <div class="metric-unit">bpm</div>
        <div class="status-indicator status-good" id="hr-status"></div>
        <span id="hr-text">Normal</span>
      </div>
      <div class="metric-card">
        <div class="metric-title">Estado General</div>
        <div class="metric-value" id="overall-status">--</div>
        <div class="metric-unit">Estado</div>
        <div class="status-indicator status-good" id="overall-indicator"></div>
        <span id="overall-text">Monitoreando</span>
      </div>
    </div>

    <div style="text-align:center;">
      <button class="button-next" onclick="mostrarSiguiente()">Mostrar siguiente dato</button>
    </div>

    <div class="chart-container">
      <div class="chart-title">Tendencias en Tiempo Real</div>
      <canvas id="trendsChart" width="400" height="200"></canvas>
    </div>

    <div class="chart-container">
      <div class="chart-title">Rutina de Ejercicio Actual</div>
      <div id="routine-info" class="loading">Cargando rutina...</div>
    </div>
  </div>

  <script>
    let datos = [];
    let indiceActual = 0;

    async function cargarDatos() {
      const respuesta = await fetch('datos.json');
      datos = await respuesta.json();
      indiceActual = 0;
      if (datos.length > 0) {
        mostrarDato(datos[0]);
      }
    }

    function mostrarDato(dato) {
      document.getElementById('spo2-value').textContent = dato.spo2.toFixed(1);
      document.getElementById('co2-value').textContent = dato.co2.toFixed(0);
      document.getElementById('hr-value').textContent = dato.hr.toFixed(0);

      updateStatus('spo2', dato.spo2, 95, 100);
      updateStatus('co2', dato.co2, 400, 600);
      updateStatus('hr', dato.hr, 60, 100);

      const now = new Date().toLocaleTimeString();
      trendsChart.data.labels.push(now);
      trendsChart.data.datasets[0].data.push(dato.spo2);
      trendsChart.data.datasets[1].data.push(dato.co2);
      trendsChart.data.datasets[2].data.push(dato.hr);

      if (trendsChart.data.labels.length > 20) {
        trendsChart.data.labels.shift();
        trendsChart.data.datasets.forEach(ds => ds.data.shift());
      }
      trendsChart.update();
    }

    function mostrarSiguiente() {
      if (datos.length === 0) return;
      indiceActual++;
      if (indiceActual >= datos.length) {
        indiceActual = 0; // Reinicia al principio o ajusta seg√∫n tu preferencia
      }
      mostrarDato(datos[indiceActual]);
    }

    const ctx = document.getElementById('trendsChart').getContext('2d');
    const trendsChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: [],
        datasets: [{
          label: 'SpO‚ÇÇ (%)',
          data: [],
          borderColor: '#4CAF50',
          backgroundColor: 'rgba(76,175,80,0.1)',
          tension: 0.4
        }, {
          label: 'CO‚ÇÇ (ppm)',
          data: [],
          borderColor: '#FF9800',
          backgroundColor: 'rgba(255,152,0,0.1)',
          tension: 0.4
        }, {
          label: 'Frecuencia Card√≠aca (bpm)',
          data: [],
          borderColor: '#2196F3',
          backgroundColor: 'rgba(33,150,243,0.1)',
          tension: 0.4
        }]
      },
      options: {
        responsive:true,
        scales: { y: { beginAtZero: false } },
        plugins: { legend: { position: 'top' } }
      }
    });

    function getStatusText(value, min, max){
      if(value >= min && value <= max) return 'Normal';
      else if(value < min * 0.9 || value > max * 1.1) return 'Alerta';
      else return 'Atenci√≥n';
    }

    function updateStatus(metric, value, min, max){
      const s = document.getElementById(metric + '-status');
      const t = document.getElementById(metric + '-text');
      if(value >= min && value <= max){ s.className='status-indicator status-good'; t.textContent='Normal';}
      else if(value < min * 0.9 || value > max * 1.1){ s.className='status-indicator status-danger'; t.textContent='Alerta';}
      else{ s.className='status-indicator status-warning'; t.textContent='Atenci√≥n';}
    }

    async function loadCurrentRoutine(){
      try{
        const response = await fetch('/api/routine/current');
        const routine = await response.json();
        document.getElementById('routine-info').innerHTML = `
          <h3>${routine.name}</h3>
          <p><strong>Duraci√≥n:</strong> ${routine.duration} minutos</p>
          <p><strong>Intensidad:</strong> ${routine.intensity}</p>
          <p><strong>Pr√≥ximo ejercicio:</strong> ${routine.nextExercise}</p>
        `;
      } catch(e){
        document.getElementById('routine-info').innerHTML = '<p>No hay rutina activa. Usa el bot de Telegram para crear una nueva rutina.</p>';
      }
    }

    loadCurrentRoutine();
    cargarDatos();
  </script>
</body>
</html>



